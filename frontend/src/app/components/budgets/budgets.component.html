<div class="w-full min-h-screen bg-gray-50 py-6 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header Section -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <h1 class="text-2xl font-bold text-gray-800">Budget Allocations</h1>
        <button 
          mat-raised-button
                color="primary" 

          (click)="addBudget()"
          >
          <mat-icon class="text-slate-900">add</mat-icon>
          Add New Budget
        </button>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-6" [formGroup]="filterForm">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Filter Budgets</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            <mat-option value="">All Categories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Choose a date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="period">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker startView="multi-year" panelClass="month-year-datepicker" (monthSelected)="onMonthSelected($event, picker)"></mat-datepicker>
        </mat-form-field>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button mat-raised-button color="primary" (click)="applyFilter()">Apply Filter</button>
        <button mat-button (click)="clearFilter()">Clear Filter</button>
      </div>
    </div>

    <!-- Content Section -->
    <div class="bg-white rounded-xl shadow-sm p-6 text-slate-900">
      <!-- Loading State -->
      <div *ngIf="loading" class="flex justify-center items-center p-8">
        <mat-progress-bar mode="indeterminate" class="w-full"></mat-progress-bar>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage && !loading" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-center">
          <mat-icon class="text-red-500 mr-2">error</mat-icon>
          <span class="text-red-700 font-medium">{{ errorMessage }}</span>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && !errorMessage && budgets.length === 0 && !isFilterActive()" class="text-center py-12">
        <div class="max-w-md mx-auto">
          <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
            <mat-icon class="text-gray-500">account_balance_wallet</mat-icon>
          </div>
          <h3 class="text-lg font-medium text-slate-900 mb-2">No budgets allocated yet</h3>
          <p class="text-gray-500 mb-6">Click "Add New Budget" to get started with your financial planning!</p>
          <button 
            class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-slate-900 font-medium py-2 px-4 rounded-lg transition-colors duration-200"
            (click)="addBudget()"
          >
            <mat-icon class="text-slate-900">add</mat-icon>
            Create Your First Budget
          </button>
        </div>
      </div>

      <!-- Empty State when filters are active -->
      <div *ngIf="!loading && !errorMessage && budgets.length === 0 && isFilterActive()" class="text-center py-12">
        <div class="max-w-md mx-auto">
          <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
            <mat-icon class="text-gray-500">filter_alt_off</mat-icon>
          </div>
          <h3 class="text-lg font-medium text-slate-900 mb-2">No budgets match your filters</h3>
          <p class="text-gray-500 mb-6">Try adjusting your filter settings or adding a new budget.</p>
          <button 
            class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-slate-900 font-medium py-2 px-4 rounded-lg transition-colors duration-200"
            (click)="addBudget()"
          >
            <mat-icon class="text-slate-900">add</mat-icon>
            Add New Budget
          </button>
        </div>
      </div>

      <!-- Budgets Table -->
      <div *ngIf="!loading && !errorMessage && budgets.length > 0" class="overflow-x-auto">
        <table mat-table [dataSource]="budgets" matSort (matSortChange)="onSortChange($event)" class="w-full min-w-full">
          <!-- Category Column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
              Category
            </th>
            <td mat-cell *matCellDef="let budget" class="px-4 py-3 text-sm text-slate-900">
              {{ getCategoryName(budget.category)}}
            </td>
          </ng-container>

          <!-- Period Column -->
          <ng-container matColumnDef="period">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
              Period
            </th>
            <td mat-cell *matCellDef="let budget" class="px-4 py-3 text-sm text-slate-900">
              {{ getMonthName(budget.month) }} {{ budget.year }}
            </td>
          </ng-container>

          <!-- Allocated Amount Column -->
          <ng-container matColumnDef="allocatedAmount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
              Allocated Amount
            </th>
            <td mat-cell *matCellDef="let budget" class="px-4 py-3 text-sm font-medium text-slate-900">
              {{ budget.amount | currency }}
            </td>
          </ng-container>

          <!-- Spent Amount Column -->
          <ng-container matColumnDef="spentAmount">
            <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
              Spent
            </th>
            <td mat-cell *matCellDef="let budget" class="px-4 py-3 text-sm text-slate-900">
              {{ getSpentAmount(budget) | currency }}
            </td>
          </ng-container>

          <!-- Remaining Amount Column -->
          <ng-container matColumnDef="remainingAmount">
            <th mat-header-cell *matHeaderCellDef>Remaining Amount</th>
            <td mat-cell *matCellDef="let budget">{{ getRemainingAmount(budget) | currency }}</td>
          </ng-container>

          <!-- Progress Column -->
          <ng-container matColumnDef="progress">
            <th mat-header-cell *matHeaderCellDef>Progress</th>
            <td mat-cell *matCellDef="let budget">
              <div class="progress-container">
                <mat-progress-bar mode="determinate" [value]="getSpentPercentage(budget)"></mat-progress-bar>
                <span class="progress-percentage">{{ getSpentPercentage(budget) | number:'1.2-2' }}%</span>
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
              Status
            </th>
            <td mat-cell *matCellDef="let budget" class="px-4 py-3">
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [ngClass]="{
                  'bg-red-100 text-red-800': getBudgetStatus(budget) === 'exceeded',
                  'bg-yellow-100 text-yellow-800': getBudgetStatus(budget) === 'warning',
                  'bg-green-100 text-green-800': getBudgetStatus(budget) === 'on-track'
                }"
              >
                {{ getBudgetStatus(budget) | titlecase }}
              </span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
              Actions
            </th>
            <td mat-cell *matCellDef="let budget" class="px-4 py-3">
              <div class="flex items-center gap-1">
                <button 
                  mat-icon-button 
                  color="accent" 
                  (click)="editBudget(budget)"
                  class="text-blue-600 hover:bg-blue-50 rounded-full p-1 transition-colors duration-200"
                >
                  <mat-icon class="text-lg">edit</mat-icon>
                </button>
                <button 
                  mat-icon-button 
                  color="warn" 
                  (click)="deleteBudget(budget.id)"
                  class="text-red-600 hover:bg-red-50 rounded-full p-1 transition-colors duration-200"
                >
                  <mat-icon class="text-lg">delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
          <tr 
            mat-row 
            *matRowDef="let row; columns: displayedColumns;" 
            class="border-b border-gray-200 hover:bg-gray-50 transition-colors duration-150"
          ></tr>
        </table>
        
        <!-- Pagination -->
        <div class="mt-6">
          <mat-paginator 
            [pageSizeOptions]="[5, 10, 25, 50]" 
            [pageSize]="pageSize" 
            [pageIndex]="pageIndex" 
            [length]="totalItems" 
            (page)="onPageChange($event)" 
            showFirstLastButtons
          ></mat-paginator>
        </div>
      </div>
    </div>
  </div>
</div>